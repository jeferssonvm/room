"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.read = void 0;

function read(path, settings, callback) {
  settings.fs.lstat(path, function (lstatError, lstat) {
    if (lstatError !== null) {
      callFailureCallback(callback, lstatError);
      return;
    }

    if (!lstat.isSymbolicLink() || !settings.followSymbolicLink) {
      callSuccessCallback(callback, lstat);
      return;
    }

    settings.fs.stat(path, function (statError, stat) {
      if (statError !== null) {
        if (settings.throwErrorOnBrokenSymbolicLink) {
          callFailureCallback(callback, statError);
          return;
        }

        callSuccessCallback(callback, lstat);
        return;
      }

      if (settings.markSymbolicLink) {
        stat.isSymbolicLink = function () {
          return true;
        };
      }

      callSuccessCallback(callback, stat);
    });
  });
}

exports.read = read;

function callFailureCallback(callback, error) {
  callback(error);
}

function callSuccessCallback(callback, result) {
  callback(null, result);
}